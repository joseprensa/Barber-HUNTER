<!DOCTYPE html>
<html>
<head>
  <title>Admin Interface</title>
  <!-- Add Bootstrap CSS for styling -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Appointments</h2>
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Date</th>
                <th>Time</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="appointments-body">
              <!-- Appointments will be dynamically added here -->
            </tbody>
          </table>
        </div>
        <button onclick="logout()" class="btn btn-danger">Logout</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/7.6.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-analytics.js"></script>
    
    <script>
      var firebaseConfig = {
      apiKey: "AIzaSyARUxSIQr0l69z6Fshkn7UVBm9J_Zxj4nQ",
      authDomain: "barber-hunter-623e9.firebaseapp.com",
      databaseURL: "https://barber-hunter-623e9-default-rtdb.firebaseio.com",
      projectId: "barber-hunter-623e9",
      storageBucket: "barber-hunter-623e9.appspot.com",
      messagingSenderId: "40429391612",
      appId: "1:40429391612:web:efcfec9781ca068605d179",
      measurementId: "G-VPRMN8CSPG"
    };
      // Initialize Firebases
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
  </script>
<script>

    // Function to check if the user is authenticated
    function checkAuthentication() {
      var isLoggedIn = sessionStorage.getItem('isLoggedIn');

      if (!isLoggedIn) {
        // If user is not authenticated, redirect to login page
        window.location.href = 'login.html';
      }
    }

    // Call the function to check authentication on page load
    checkAuthentication();

    function logout() {
      // Clear the session variable to indicate the user is logged out
      sessionStorage.removeItem('isLoggedIn');
      // Redirect to login page
      window.location.href = 'login.html';
    }
    // Function to display appointments in the admin interface
    function displayAppointments() {
    var appointmentsRef = firebase.database().ref('Request');

    appointmentsRef.on('value', function(snapshot) {
      var appointments = snapshot.val();
      var appointmentsTable = document.getElementById('appointments-body');
      appointmentsTable.innerHTML = "";

      for (var key in appointments) {
        if (appointments.hasOwnProperty(key)) {
          var appointment = appointments[key];
          var row = "<tr>" +
                    "<td>" + appointment.Name + "</td>" +
                    "<td>" + appointment.Email + "</td>" +
                    "<td>" + appointment.Phone + "</td>" +
                    "<td>" + appointment.Date + "</td>" +
                    "<td>" + appointment.Time + "</td>" +
                    "<td><button onclick='deleteAppointment(\"" + key + "\")' class='btn btn-danger btn-sm'>Delete</button></td>" +
                    "</tr>";
          appointmentsTable.innerHTML += row;
        }
      }
    });
  }

  // Function to delete an appointment
  function deleteAppointment(key) {
    var appointmentRef = firebase.database().ref('Request').child(key);
    appointmentRef.remove()
      .then(function() {
        // Refresh the appointments table after deletion
        displayAppointments();
      })
      .catch(function(error) {
        console.error("Error deleting appointment:", error);
      });
  }

  // Call the function to display appointments on page load
  displayAppointments();
  </script>
</body>
</html>